---
title: "Расчёт размера выборки для климаксана"
author: "Alexey Gordeev"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(epiR)
library(TrialSize)
```

Среднее изменение приливов в день через 12 дней = -3.17 (95%ДИ[-3.97, -2.37]).

Подсчёт SD

$CI_h = μ + 1.96 × (σ / √n)$

$-2.37 = -3.17 + 1.96 × (σ / √351)$

$0.8 = 1.96 × (σ / √351)$

$0.408 = σ / √351$

$σ = 0.408 × √351$

```{r}
((-2.37-(-3.17)) / 1.96 * sqrt(351)) %>% round(2)
```

$σ = 7.65$

Исследование не меньшей эффективности.

Гипотеза не меньшей эффективности была сформулирована следующим образом:

$H_0$: $μ_T - μ_R ≤ δ$ 

$H_A$: $μ_T - μ_R > δ$

Где $μ_T$ -- изменение частоты приливов в день через 12 недель по сравнению с визитом 1 в группе терапией Климаксаном; $μ_R$ -- изменение частоты приливов в день через 12 недель по сравнению с визитом 1 в группе терапией Анжеликом; $δ$ -- граница не меньшей эффективности, равная -2.

Изменение частоты приливов в день -- количественная конечная точка.

При расчёте размера выборки были сделаны следующие допущения:

1. Величина ошибки I рода (α) для односторонней гипотезы равна 0.025;

2. Предполагаемая мощность исследования -- 80%, то есть предельная величина ошибки II рода (β) равна 0.2;

3. По литературным данным, среднее изменение приливов в день через 12 дней составляет -3.17; σ = 7.65. Ожидается, что Климаксаном в среднем будет снижать частоту приливов в сутки к 12 неделе также, как и Анжелик. Примем допущение о том, что стандартное отклонение разницы количества приливов при применении Климаксаном равно значению стандартного отклонения при применении Анжелика.

4. Граница не меньшей эффективности Климаксана по сравнению с Анжеликом равна -2.

5. Предполагается рандомизировать пациентов в группы с одинаковым соотношением (1:1).

6. Частота выбывания пациентов в ходе скрининга -- 10%, в ходе исследования -- 20%.

Расчёт размера выборки был проведён в RStudio (версия 2025.09.1 Build 401) c использованием языка R (версия 4.5.1) с помощью функции epi.sssupc пакета epiR (версия 2.0.88).

Из-за особенностей функции epi.sssupc ($δ$ должна быть строго положительная) и нашего исследовательского вопроса в формулу необходимо подставлять ожидаемые средние значения и дельту, умноженные на -1.

Результаты расчёта приведены далее.

*Подсчёт с помощью epiR*

```{r cars}
epi.ssninfc(
    treat = 3.17,
    control = 3.17,
    sigma = 7.65,
    delta = 2,
    n = NA,
    power = 0.8,
    alpha = 0.025,
    r = 1
)
```

*Проверка с помощью TrialSize*

```{r}
TwoSampleMean.NIS(
    alpha = 0.025,
    beta = 0.2,
    sigma = 7.65,
    k = 1,
    delta = 0,
    margin = -2
)
```

*Учёт выбывания пациентов*

```{r ceil}
# С учётом выбывания из исследования
(230/0.8) %>% ceiling()

# С учётом выбывания из скрининга
(288/0.9) %>% ceiling() # T group
```

При 20% частоте выбывания пациентов в ходе исследования в каждую группу лечения необходимо набрать не менее 230 человек, всего 576 человек; число пациентов на этапе скрининга при выбывания 10% пациентов может достигать всего 640 человек.
